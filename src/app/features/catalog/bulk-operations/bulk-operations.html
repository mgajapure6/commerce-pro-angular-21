<div class="min-h-screen bg-gray-50/50 p-4 sm:p-6 lg:p-8">
    <div class="max-w-[1600px] mx-auto space-y-6">

        <!-- Header Section -->
        <div
            class="flex flex-col lg:flex-row lg:items-center justify-between gap-4 bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
            <div>
                <div class="flex items-center gap-3">
                    <button routerLink="/products"
                        class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                        <i class="bi bi-arrow-left text-xl"></i>
                    </button>
                    <h1 class="text-2xl font-bold text-gray-900">Bulk Operations</h1>
                    <span class="px-3 py-1 bg-indigo-100 text-indigo-700 text-sm font-medium rounded-full">
                        {{ selectedCount() }} selected
                    </span>
                </div>
                <p class="text-gray-500 mt-1 text-sm ml-12">Mass edit, import, or export products efficiently</p>
            </div>
            <div class="flex flex-wrap items-center gap-3">
                <button (click)="showHistory.set(!showHistory())"
                    class="px-4 py-2.5 bg-white border border-gray-200 rounded-xl text-sm font-medium text-gray-700 hover:bg-gray-50 transition-all flex items-center gap-2 shadow-sm">
                    <i class="bi bi-clock-history"></i>
                    <span class="hidden sm:inline">History</span>
                </button>
                <app-dropdown label="Templates" [items]="templateItems" [showChevron]="true" triggerClass="shadow-sm"
                    (itemSelected)="onTemplateSelect($event)">
                </app-dropdown>
                <button (click)="showSettings.set(true)"
                    class="p-2.5 bg-white border border-gray-200 rounded-xl text-gray-700 hover:border-indigo-300 hover:text-indigo-600 transition-all shadow-sm">
                    <i class="bi bi-gear"></i>
                </button>
            </div>
        </div>

        <!-- Operation Type Selector -->
        <div class="bg-white rounded-2xl p-2 shadow-sm border border-gray-100">
            <div class="flex flex-wrap gap-2">
                @for (op of operations(); track op.id) {
                <button (click)="setActiveOperation(op.id)"
                    class="flex-1 min-w-[140px] px-4 py-3 rounded-xl text-sm font-medium transition-all flex items-center justify-center gap-2"
                    [class.bg-indigo-600]="activeOperation() === op.id" [class.text-white]="activeOperation() === op.id"
                    [class.shadow-md]="activeOperation() === op.id" [class.bg-gray-50]="activeOperation() !== op.id"
                    [class.text-gray-700]="activeOperation() !== op.id"
                    [class.hover:bg-gray-100]="activeOperation() !== op.id">
                    <i class="bi bi-{{op.icon}}"></i>
                    {{ op.label }}
                </button>
                }
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- Left Panel: Selection & Preview -->
            <div class="lg:col-span-1 space-y-6">

                <!-- Selection Summary -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="text-sm font-semibold text-gray-900 mb-4 flex items-center gap-2">
                        <i class="bi bi-check-square text-indigo-600"></i>
                        Selected Products
                    </h3>

                    @if (selectedProducts().length > 0) {
                    <div class="space-y-3 max-h-[400px] overflow-y-auto">
                        @for (product of selectedProducts(); track product.id) {
                        <div
                            class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl group hover:bg-indigo-50 transition-colors">
                            <img [src]="product.image" [alt]="product.name"
                                class="w-12 h-12 rounded-lg object-cover bg-gray-200">
                            <div class="flex-1 min-w-0">
                                <p class="font-medium text-gray-900 text-sm truncate">{{ product.name }}</p>
                                <p class="text-xs text-gray-500">{{ product.sku }}</p>
                            </div>
                            <button (click)="removeFromSelection(product.id)"
                                class="p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors opacity-0 group-hover:opacity-100">
                                <i class="bi bi-x-lg"></i>
                            </button>
                        </div>
                        }
                    </div>

                    <div class="mt-4 pt-4 border-t border-gray-100 flex items-center justify-between">
                        <span class="text-sm text-gray-500">{{ selectedProducts().length }} items</span>
                        <button (click)="clearSelection()" class="text-sm text-red-600 hover:text-red-700 font-medium">
                            Clear all
                        </button>
                    </div>
                    } @else {
                    <div class="text-center py-8">
                        <div class="w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-3">
                            <i class="bi bi-box-seam text-gray-400 text-2xl"></i>
                        </div>
                        <p class="text-sm text-gray-500 mb-3">No products selected</p>
                        <button (click)="openProductSelector()"
                            class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors">
                            Select Products
                        </button>
                    </div>
                    }
                </div>

                <!-- Quick Stats -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="text-sm font-semibold text-gray-900 mb-4">Selection Stats</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500">Categories</span>
                            <span class="text-sm font-medium text-gray-900">{{ uniqueCategories() }}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500">Brands</span>
                            <span class="text-sm font-medium text-gray-900">{{ uniqueBrands() }}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500">Total Value</span>
                            <span class="text-sm font-medium text-gray-900">${{ totalValue() | number:'1.2-2' }}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500">Avg. Price</span>
                            <span class="text-sm font-medium text-gray-900">${{ averagePrice() | number:'1.2-2'
                                }}</span>
                        </div>
                    </div>
                </div>

                <!-- Validation Panel -->
                @if (validationErrors().length > 0) {
                <div class="bg-red-50 rounded-2xl p-6 border border-red-100">
                    <h3 class="text-sm font-semibold text-red-900 mb-3 flex items-center gap-2">
                        <i class="bi bi-exclamation-triangle"></i>
                        Validation Errors ({{ validationErrors().length }})
                    </h3>
                    <div class="space-y-2 max-h-[200px] overflow-y-auto">
                        @for (error of validationErrors(); track error.id) {
                        <div class="flex items-start gap-2 text-sm">
                            <i class="bi bi-x-circle-fill text-red-500 mt-0.5"></i>
                            <div>
                                <p class="font-medium text-red-800">{{ error.product }}</p>
                                <p class="text-red-600">{{ error.message }}</p>
                            </div>
                        </div>
                        }
                    </div>
                </div>
                }
            </div>

            <!-- Center Panel: Operation Configuration -->
            <div class="lg:col-span-2 space-y-6">

                <!-- Mass Edit Operation -->
                @if (activeOperation() === 'edit') {
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <div class="flex items-center gap-3 mb-6 pb-4 border-b border-gray-100">
                        <div class="w-10 h-10 bg-indigo-100 rounded-xl flex items-center justify-center">
                            <i class="bi bi-pencil-square text-indigo-600 text-lg"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900">Mass Edit Products</h2>
                            <p class="text-sm text-gray-500">Update multiple fields across selected products</p>
                        </div>
                    </div>

                    <!-- Field Selector -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Fields to Edit</label>
                        <div class="flex flex-wrap gap-2">
                            @for (field of editableFields(); track field.id) {
                            <button (click)="toggleFieldSelection(field.id)"
                                class="px-3 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2"
                                [class.bg-indigo-600]="selectedFields().includes(field.id)"
                                [class.text-white]="selectedFields().includes(field.id)"
                                [class.bg-gray-100]="!selectedFields().includes(field.id)"
                                [class.text-gray-700]="!selectedFields().includes(field.id)">
                                <i class="bi bi-{{field.icon}}"></i>
                                {{ field.label }}
                                @if (selectedFields().includes(field.id)) {
                                <i class="bi bi-check-lg"></i>
                                }
                            </button>
                            }
                        </div>
                    </div>

                    <!-- Edit Forms -->
                    <div class="space-y-4">
                        @for (fieldId of selectedFields(); track fieldId) {
                        @switch (fieldId) {
                        @case ('status') {
                        <div class="p-4 bg-gray-50 rounded-xl">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select [(ngModel)]="bulkValues().status"
                                class="w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500">
                                <option value="active">Active</option>
                                <option value="draft">Draft</option>
                                <option value="archived">Archived</option>
                                <option value="discontinued">Discontinued</option>
                            </select>
                        </div>
                        }
                        @case ('category') {
                        <div class="p-4 bg-gray-50 rounded-xl">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                            <select [(ngModel)]="bulkValues().category"
                                class="w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500">
                                @for (cat of availableCategories(); track cat.id) {
                                <option [value]="cat.id">{{ cat.name }}</option>
                                }
                            </select>
                        </div>
                        }
                        @case ('price') {
                        <div class="p-4 bg-gray-50 rounded-xl">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Price Adjustment</label>
                            <div class="flex gap-3">
                                <select [(ngModel)]="bulkValues().priceOperation"
                                    class="px-3 py-2 bg-white border border-gray-200 rounded-lg">
                                    <option value="set">Set to</option>
                                    <option value="increase_percent">Increase by %</option>
                                    <option value="decrease_percent">Decrease by %</option>
                                    <option value="increase_fixed">Increase by $</option>
                                    <option value="decrease_fixed">Decrease by $</option>
                                </select>
                                <input type="number" [(ngModel)]="bulkValues().priceValue" placeholder="0.00"
                                    class="flex-1 px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500">
                            </div>
                            @if (pricePreview() !== null) {
                            <p class="mt-2 text-sm text-indigo-600">
                                Preview: Average price will change from ${{ averagePrice() | number:'1.2-2' }} to ${{
                                pricePreview() | number:'1.2-2' }}
                            </p>
                            }
                        </div>
                        }
                        @case ('stock') {
                        <div class="p-4 bg-gray-50 rounded-xl">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Stock Adjustment</label>
                            <div class="flex gap-3">
                                <select [(ngModel)]="bulkValues().stockOperation"
                                    class="px-3 py-2 bg-white border border-gray-200 rounded-lg">
                                    <option value="set">Set to</option>
                                    <option value="add">Add</option>
                                    <option value="subtract">Subtract</option>
                                </select>
                                <input type="number" [(ngModel)]="bulkValues().stockValue" placeholder="0"
                                    class="flex-1 px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500">
                            </div>
                        </div>
                        }
                        @case ('tags') {
                        <div class="p-4 bg-gray-50 rounded-xl">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tags</label>
                            <div class="flex gap-2 mb-3">
                                <select [(ngModel)]="bulkValues().tagOperation"
                                    class="px-3 py-2 bg-white border border-gray-200 rounded-lg">
                                    <option value="add">Add tags</option>
                                    <option value="remove">Remove tags</option>
                                    <option value="replace">Replace all</option>
                                </select>
                            </div>
                            <div class="flex flex-wrap gap-2 p-2 bg-white border border-gray-200 rounded-lg">
                                @for (tag of bulkValues().tags; track tag) {
                                <span
                                    class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-sm flex items-center gap-1">
                                    {{ tag }}
                                    <button (click)="removeBulkTag(tag)" class="hover:text-indigo-900"><i
                                            class="bi bi-x"></i></button>
                                </span>
                                }
                                <input type="text" [(ngModel)]="newTagInput" (keydown.enter)="addBulkTag()"
                                    placeholder="Add tag..." class="flex-1 min-w-[100px] outline-none text-sm">
                            </div>
                        </div>
                        }
                        @case ('brand') {
                        <div class="p-4 bg-gray-50 rounded-xl">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Brand</label>
                            <select [(ngModel)]="bulkValues().brand"
                                class="w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500">
                                @for (brand of availableBrands(); track brand) {
                                <option [value]="brand">{{ brand }}</option>
                                }
                            </select>
                        </div>
                        }
                        @case ('weight') {
                        <div class="p-4 bg-gray-50 rounded-xl">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Weight</label>
                            <div class="flex gap-3">
                                <input type="number" [(ngModel)]="bulkValues().weight" placeholder="0.00"
                                    class="flex-1 px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500">
                                <select [(ngModel)]="bulkValues().weightUnit"
                                    class="px-3 py-2 bg-white border border-gray-200 rounded-lg">
                                    <option value="kg">kg</option>
                                    <option value="lb">lb</option>
                                    <option value="oz">oz</option>
                                </select>
                            </div>
                        </div>
                        }
                        @case ('description') {
                        <div class="p-4 bg-gray-50 rounded-xl">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                            <div class="flex gap-2 mb-3">
                                <select [(ngModel)]="bulkValues().descriptionOperation"
                                    class="px-3 py-2 bg-white border border-gray-200 rounded-lg text-sm">
                                    <option value="replace">Replace all</option>
                                    <option value="append">Append to end</option>
                                    <option value="prepend">Prepend to start</option>
                                    <option value="find_replace">Find & Replace</option>
                                </select>
                            </div>
                            @if (bulkValues().descriptionOperation === 'find_replace') {
                            <div class="space-y-2 mb-3">
                                <input type="text" [(ngModel)]="bulkValues().findText" placeholder="Find text..."
                                    class="w-full px-3 py-2 bg-white border border-gray-200 rounded-lg">
                                <input type="text" [(ngModel)]="bulkValues().replaceText" placeholder="Replace with..."
                                    class="w-full px-3 py-2 bg-white border border-gray-200 rounded-lg">
                            </div>
                            }
                            <textarea [(ngModel)]="bulkValues().description" rows="3" placeholder="Enter description..."
                                class="w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 resize-none"></textarea>
                        </div>
                        }
                        }
                        }
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex items-center justify-between mt-6 pt-6 border-t border-gray-100">
                        <button (click)="validateBulkEdit()"
                            class="px-4 py-2.5 text-gray-700 font-medium hover:bg-gray-100 rounded-xl transition-colors flex items-center gap-2">
                            <i class="bi bi-check-circle"></i>
                            Validate Changes
                        </button>
                        <div class="flex gap-3">
                            <button (click)="previewChanges()"
                                class="px-4 py-2.5 bg-white border border-gray-200 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-all flex items-center gap-2">
                                <i class="bi bi-eye"></i>
                                Preview
                            </button>
                            <button (click)="executeBulkEdit()"
                                [disabled]="selectedFields().length === 0 || isProcessing()"
                                class="px-6 py-2.5 bg-indigo-600 text-white rounded-xl font-medium hover:bg-indigo-700 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-indigo-200">
                                @if (isProcessing()) {
                                <i class="bi bi-arrow-repeat spin"></i>
                                <span>Processing...</span>
                                } @else {
                                <i class="bi bi-lightning-charge"></i>
                                <span>Apply Changes</span>
                                }
                            </button>
                        </div>
                    </div>
                </div>
                }

                <!-- Import Operation -->
                @if (activeOperation() === 'import') {
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <div class="flex items-center gap-3 mb-6 pb-4 border-b border-gray-100">
                        <div class="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center">
                            <i class="bi bi-upload text-green-600 text-lg"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900">Import Products</h2>
                            <p class="text-sm text-gray-500">Upload CSV or Excel file to bulk import products</p>
                        </div>
                    </div>

                    <!-- Upload Area -->
                    <div class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-indigo-400 hover:bg-indigo-50/30 transition-all cursor-pointer"
                        (click)="fileInput.click()" (dragover)="$event.preventDefault()" (drop)="onFileDrop($event)">

                        @if (uploadedFile(); as file) {
                        <div class="flex flex-col items-center">
                            <div class="w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center mb-4">
                                <i class="bi bi-file-earmark-check text-green-600 text-2xl"></i>
                            </div>
                            <p class="font-medium text-gray-900 mb-1">{{ file.name }}</p>
                            <p class="text-sm text-gray-500 mb-3">{{ (file.size / 1024).toFixed(1) }} KB â€¢ Ready to
                                process</p>
                            <button (click)="$event.stopPropagation(); removeUploadedFile()"
                                class="text-sm text-red-600 hover:text-red-700 font-medium">
                                Remove file
                            </button>
                        </div>
                        } @else {
                        <div class="flex flex-col items-center">
                            <div class="w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mb-4">
                                <i class="bi bi-cloud-arrow-up text-gray-400 text-2xl"></i>
                            </div>
                            <p class="font-medium text-gray-900 mb-1">Click to upload or drag and drop</p>
                            <p class="text-sm text-gray-500 mb-3">CSV, Excel, or JSON (max 10MB)</p>
                            <div class="flex gap-2">
                                <span class="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-xs">CSV</span>
                                <span class="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-xs">Excel</span>
                                <span class="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-xs">JSON</span>
                            </div>
                        </div>
                        }
                        <input #fileInput type="file" accept=".csv,.xlsx,.xls,.json" class="hidden"
                            (change)="onFileSelected($event)">
                    </div>

                    <!-- Import Options -->
                    <div class="mt-6 space-y-4">
                        <h3 class="text-sm font-semibold text-gray-900">Import Options</h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <label
                                class="flex items-start gap-3 cursor-pointer p-3 rounded-xl hover:bg-gray-50 transition-colors">
                                <input type="radio" name="importMode" [(ngModel)]="importMode" value="create"
                                    class="w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500 mt-0.5">
                                <div>
                                    <span class="text-sm font-medium text-gray-900">Create New Only</span>
                                    <p class="text-xs text-gray-500">Skip existing products</p>
                                </div>
                            </label>

                            <label
                                class="flex items-start gap-3 cursor-pointer p-3 rounded-xl hover:bg-gray-50 transition-colors">
                                <input type="radio" name="importMode" [(ngModel)]="importMode" value="update"
                                    class="w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500 mt-0.5">
                                <div>
                                    <span class="text-sm font-medium text-gray-900">Update Existing</span>
                                    <p class="text-xs text-gray-500">Match by SKU and update</p>
                                </div>
                            </label>

                            <label
                                class="flex items-start gap-3 cursor-pointer p-3 rounded-xl hover:bg-gray-50 transition-colors">
                                <input type="radio" name="importMode" [(ngModel)]="importMode" value="upsert"
                                    class="w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500 mt-0.5">
                                <div>
                                    <span class="text-sm font-medium text-gray-900">Create or Update</span>
                                    <p class="text-xs text-gray-500">Create new or update existing</p>
                                </div>
                            </label>

                            <label
                                class="flex items-start gap-3 cursor-pointer p-3 rounded-xl hover:bg-gray-50 transition-colors">
                                <input type="radio" name="importMode" [(ngModel)]="importMode" value="replace"
                                    class="w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500 mt-0.5">
                                <div>
                                    <span class="text-sm font-medium text-gray-900">Replace All</span>
                                    <p class="text-xs text-gray-500">Delete existing and import fresh</p>
                                </div>
                            </label>
                        </div>

                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl">
                            <input type="checkbox" id="skipValidation" [(ngModel)]="skipValidation"
                                class="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            <label for="skipValidation" class="text-sm text-gray-700 cursor-pointer">
                                Skip validation (faster but may import invalid data)
                            </label>
                        </div>
                    </div>

                    <!-- Template Download -->
                    <div class="mt-6 p-4 bg-blue-50 rounded-xl border border-blue-100">
                        <div class="flex items-start gap-3">
                            <i class="bi bi-info-circle text-blue-600 mt-0.5"></i>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-blue-900 mb-1">Need a template?</p>
                                <p class="text-sm text-blue-700 mb-3">Download our CSV template with all required fields
                                    and sample data.</p>
                                <div class="flex gap-2">
                                    <button (click)="downloadTemplate('csv')"
                                        class="px-3 py-1.5 bg-white text-blue-600 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors">
                                        <i class="bi bi-download mr-1"></i> CSV Template
                                    </button>
                                    <button (click)="downloadTemplate('excel')"
                                        class="px-3 py-1.5 bg-white text-blue-600 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors">
                                        <i class="bi bi-download mr-1"></i> Excel Template
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Import Preview -->
                    @if (importPreview().length > 0) {
                    <div class="mt-6">
                        <h3 class="text-sm font-semibold text-gray-900 mb-3">Import Preview (First 5 rows)</h3>
                        <div class="overflow-x-auto border border-gray-200 rounded-xl">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left font-medium text-gray-700">Row</th>
                                        <th class="px-4 py-2 text-left font-medium text-gray-700">Name</th>
                                        <th class="px-4 py-2 text-left font-medium text-gray-700">SKU</th>
                                        <th class="px-4 py-2 text-left font-medium text-gray-700">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-100">
                                    @for (item of importPreview(); track $index) {
                                    <tr>
                                        <td class="px-4 py-2 text-gray-500">{{ $index + 1 }}</td>
                                        <td class="px-4 py-2 font-medium text-gray-900">{{ item.name }}</td>
                                        <td class="px-4 py-2 text-gray-600">{{ item.sku }}</td>
                                        <td class="px-4 py-2">
                                            <span class="px-2 py-0.5 rounded-full text-xs font-medium"
                                                [class.bg-green-100]="item.status === 'valid'"
                                                [class.text-green-700]="item.status === 'valid'"
                                                [class.bg-red-100]="item.status === 'error'"
                                                [class.text-red-700]="item.status === 'error'">
                                                {{ item.status | titlecase }}
                                            </span>
                                        </td>
                                    </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    }

                    <!-- Action Buttons -->
                    <div class="flex items-center justify-end gap-3 mt-6 pt-6 border-t border-gray-100">
                        <button (click)="validateImport()" [disabled]="!uploadedFile()"
                            class="px-4 py-2.5 bg-white border border-gray-200 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-all flex items-center gap-2 disabled:opacity-50">
                            <i class="bi bi-check-circle"></i>
                            Validate
                        </button>
                        <button (click)="executeImport()" [disabled]="!uploadedFile() || isProcessing()"
                            class="px-6 py-2.5 bg-green-600 text-white rounded-xl font-medium hover:bg-green-700 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-green-200">
                            @if (isProcessing()) {
                            <i class="bi bi-arrow-repeat spin"></i>
                            <span>Importing...</span>
                            } @else {
                            <i class="bi bi-upload"></i>
                            <span>Start Import</span>
                            }
                        </button>
                    </div>
                </div>
                }

                <!-- Export Operation -->
                @if (activeOperation() === 'export') {
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <div class="flex items-center gap-3 mb-6 pb-4 border-b border-gray-100">
                        <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">
                            <i class="bi bi-download text-blue-600 text-lg"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900">Export Products</h2>
                            <p class="text-sm text-gray-500">Download selected products in your preferred format</p>
                        </div>
                    </div>

                    <!-- Export Format -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">Export Format</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            @for (format of exportFormats(); track format.id) {
                            <button (click)="selectedFormat.set($any(format.id))"
                                class="p-4 border-2 rounded-xl text-center transition-all flex flex-col items-center gap-2"
                                [class.border-indigo-600]="selectedFormat() === format.id"
                                [class.bg-indigo-50]="selectedFormat() === format.id"
                                [class.border-gray-200]="selectedFormat() !== format.id"
                                [class.hover:border-indigo-300]="selectedFormat() !== format.id">
                                <i class="bi bi-{{format.icon}} text-2xl"
                                    [class.text-indigo-600]="selectedFormat() === format.id"
                                    [class.text-gray-400]="selectedFormat() !== format.id"></i>
                                <span class="font-medium text-sm"
                                    [class.text-indigo-900]="selectedFormat() === format.id"
                                    [class.text-gray-700]="selectedFormat() !== format.id">{{ format.label }}</span>
                            </button>
                            }
                        </div>
                    </div>

                    <!-- Field Selection -->
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-3">
                            <label class="text-sm font-medium text-gray-700">Fields to Export</label>
                            <div class="flex gap-2">
                                <button (click)="selectAllExportFields()"
                                    class="text-xs text-indigo-600 hover:text-indigo-700 font-medium">Select
                                    All</button>
                                <span class="text-gray-300">|</span>
                                <button (click)="deselectAllExportFields()"
                                    class="text-xs text-gray-500 hover:text-gray-700 font-medium">Deselect All</button>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3 p-4 bg-gray-50 rounded-xl">
                            @for (field of exportableFields(); track field.id) {
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" [(ngModel)]="field.selected"
                                    class="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                <span class="text-sm text-gray-700">{{ field.label }}</span>
                            </label>
                            }
                        </div>
                    </div>

                    <!-- Export Options -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-xl space-y-3">
                        <h3 class="text-sm font-medium text-gray-900 mb-3">Export Options</h3>

                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" [(ngModel)]="exportOptions().includeImages"
                                class="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            <span class="text-sm text-gray-700">Include image URLs</span>
                        </label>

                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" [(ngModel)]="exportOptions().includeVariants"
                                class="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            <span class="text-sm text-gray-700">Include variant data</span>
                        </label>

                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" [(ngModel)]="exportOptions().includeMetadata"
                                class="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            <span class="text-sm text-gray-700">Include metadata (created date, etc.)</span>
                        </label>

                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" [(ngModel)]="exportOptions().useHeaders"
                                class="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            <span class="text-sm text-gray-700">Include column headers</span>
                        </label>
                    </div>

                    <!-- Export Preview -->
                    <div class="mb-6">
                        <h3 class="text-sm font-semibold text-gray-900 mb-3">Export Summary</h3>
                        <div class="p-4 bg-gray-50 rounded-xl space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500">Products to export</span>
                                <span class="font-medium text-gray-900">{{ selectedProducts().length || 'All (' +
                                    totalProductCount() + ')' }}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500">Selected fields</span>
                                <span class="font-medium text-gray-900">{{ selectedExportFieldsCount() }} fields</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500">Estimated file size</span>
                                <span class="font-medium text-gray-900">~{{ estimatedFileSize() }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex items-center justify-end gap-3 pt-6 border-t border-gray-100">
                        <button (click)="previewExport()"
                            class="px-4 py-2.5 bg-white border border-gray-200 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-all flex items-center gap-2">
                            <i class="bi bi-eye"></i>
                            Preview
                        </button>
                        <button (click)="executeExport()"
                            [disabled]="selectedExportFieldsCount() === 0 || isProcessing()"
                            class="px-6 py-2.5 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-blue-200">
                            @if (isProcessing()) {
                            <i class="bi bi-arrow-repeat spin"></i>
                            <span>Exporting...</span>
                            } @else {
                            <i class="bi bi-download"></i>
                            <span>Download Export</span>
                            }
                        </button>
                    </div>
                </div>
                }

                <!-- Copy Operation -->
                @if (activeOperation() === 'copy') {
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <div class="flex items-center gap-3 mb-6 pb-4 border-b border-gray-100">
                        <div class="w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center">
                            <i class="bi bi-copy text-purple-600 text-lg"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900">Duplicate Products</h2>
                            <p class="text-sm text-gray-500">Create copies of selected products with modifications</p>
                        </div>
                    </div>

                    <!-- Copy Options -->
                    <div class="space-y-6">
                        <div class="p-4 bg-gray-50 rounded-xl">
                            <label class="block text-sm font-medium text-gray-700 mb-3">Naming Pattern</label>
                            <div class="space-y-3">
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="radio" name="namingPattern" [(ngModel)]="copyOptions().namingPattern"
                                        value="suffix"
                                        class="w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                    <div class="flex-1">
                                        <span class="text-sm font-medium text-gray-900">Add Suffix</span>
                                        <p class="text-xs text-gray-500">Original Name (Copy)</p>
                                    </div>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="radio" name="namingPattern" [(ngModel)]="copyOptions().namingPattern"
                                        value="prefix"
                                        class="w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                    <div class="flex-1">
                                        <span class="text-sm font-medium text-gray-900">Add Prefix</span>
                                        <p class="text-xs text-gray-500">Copy - Original Name</p>
                                    </div>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="radio" name="namingPattern" [(ngModel)]="copyOptions().namingPattern"
                                        value="custom"
                                        class="w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                    <div class="flex-1">
                                        <span class="text-sm font-medium text-gray-900">Custom Pattern</span>
                                    </div>
                                </label>
                                @if (copyOptions().namingPattern === 'custom') {
                                <input type="text" [(ngModel)]="copyOptions().customPattern"
                                    placeholder="{original} - Copy {date}"
                                    class="w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 text-sm">
                                <p class="text-xs text-gray-500">Use 'original' for original name, 'date' for current
                                    date, 'index' for number</p>
                                }
                            </div>
                        </div>

                        <div class="p-4 bg-gray-50 rounded-xl">
                            <label class="block text-sm font-medium text-gray-700 mb-3">SKU Pattern</label>
                            <div class="flex gap-3">
                                <select [(ngModel)]="copyOptions().skuPattern"
                                    class="px-3 py-2 bg-white border border-gray-200 rounded-lg text-sm">
                                    <option value="suffix">Add -COPY suffix</option>
                                    <option value="timestamp">Append timestamp</option>
                                    <option value="random">Generate new random SKU</option>
                                    <option value="custom">Custom pattern</option>
                                </select>
                                @if (copyOptions().skuPattern === 'custom') {
                                <input type="text" [(ngModel)]="copyOptions().customSkuPattern"
                                    placeholder="SKU-{original}-{date}"
                                    class="flex-1 px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 text-sm">
                                }
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <label
                                class="flex items-center gap-3 cursor-pointer p-3 rounded-xl hover:bg-gray-50 transition-colors">
                                <input type="checkbox" [(ngModel)]="copyOptions().copyImages"
                                    class="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                <div>
                                    <span class="text-sm font-medium text-gray-900">Copy Images</span>
                                    <p class="text-xs text-gray-500">Duplicate all product images</p>
                                </div>
                            </label>

                            <label
                                class="flex items-center gap-3 cursor-pointer p-3 rounded-xl hover:bg-gray-50 transition-colors">
                                <input type="checkbox" [(ngModel)]="copyOptions().copyVariants"
                                    class="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                <div>
                                    <span class="text-sm font-medium text-gray-900">Copy Variants</span>
                                    <p class="text-xs text-gray-500">Include all product variants</p>
                                </div>
                            </label>

                            <label
                                class="flex items-center gap-3 cursor-pointer p-3 rounded-xl hover:bg-gray-50 transition-colors">
                                <input type="checkbox" [(ngModel)]="copyOptions().setAsDraft"
                                    class="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                <div>
                                    <span class="text-sm font-medium text-gray-900">Set as Draft</span>
                                    <p class="text-xs text-gray-500">New copies will be inactive</p>
                                </div>
                            </label>

                            <label
                                class="flex items-center gap-3 cursor-pointer p-3 rounded-xl hover:bg-gray-50 transition-colors">
                                <input type="checkbox" [(ngModel)]="copyOptions().resetInventory"
                                    class="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                <div>
                                    <span class="text-sm font-medium text-gray-900">Reset Inventory</span>
                                    <p class="text-xs text-gray-500">Set stock to 0 for copies</p>
                                </div>
                            </label>
                        </div>

                        <div class="p-4 bg-yellow-50 rounded-xl border border-yellow-100">
                            <div class="flex items-start gap-3">
                                <i class="bi bi-exclamation-triangle text-yellow-600 mt-0.5"></i>
                                <div>
                                    <p class="text-sm font-medium text-yellow-900">Preview</p>
                                    <p class="text-sm text-yellow-700 mt-1">
                                        "{{ selectedProducts()[0]?.name || 'Product Name' }}" will become:<br>
                                        "{{ generateCopyNamePreview() }}"
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex items-center justify-end gap-3 mt-6 pt-6 border-t border-gray-100">
                        <button (click)="executeCopy()" [disabled]="selectedProducts().length === 0 || isProcessing()"
                            class="px-6 py-2.5 bg-purple-600 text-white rounded-xl font-medium hover:bg-purple-700 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-purple-200">
                            @if (isProcessing()) {
                            <i class="bi bi-arrow-repeat spin"></i>
                            <span>Duplicating...</span>
                            } @else {
                            <i class="bi bi-copy"></i>
                            <span>Create {{ selectedProducts().length }} Copies</span>
                            }
                        </button>
                    </div>
                </div>
                }

                <!-- Delete Operation -->
                @if (activeOperation() === 'delete') {
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 border-red-200">
                    <div class="flex items-center gap-3 mb-6 pb-4 border-b border-red-100">
                        <div class="w-10 h-10 bg-red-100 rounded-xl flex items-center justify-center">
                            <i class="bi bi-trash3 text-red-600 text-lg"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-red-900">Delete Products</h2>
                            <p class="text-sm text-red-600">Permanently remove selected products from the catalog</p>
                        </div>
                    </div>

                    <!-- Warning Messages -->
                    <div class="space-y-4 mb-6">
                        <div class="p-4 bg-red-50 rounded-xl border border-red-100">
                            <div class="flex items-start gap-3">
                                <i class="bi bi-exclamation-triangle-fill text-red-600 mt-0.5"></i>
                                <div>
                                    <p class="font-medium text-red-900">Warning: This action cannot be undone</p>
                                    <p class="text-sm text-red-700 mt-1">
                                        You are about to delete {{ selectedProducts().length }} product(s).
                                        This will permanently remove them from your catalog, including all associated
                                        data,
                                        images, variants, and order history references.
                                    </p>
                                </div>
                            </div>
                        </div>

                        @if (hasOrders()) {
                        <div class="p-4 bg-orange-50 rounded-xl border border-orange-100">
                            <div class="flex items-start gap-3">
                                <i class="bi bi-cart-x text-orange-600 mt-0.5"></i>
                                <div>
                                    <p class="font-medium text-orange-900">Some products have order history</p>
                                    <p class="text-sm text-orange-700 mt-1">
                                        {{ productsWithOrders() }} selected product(s) have been ordered before.
                                        Deleting them may affect order records and customer history.
                                    </p>
                                </div>
                            </div>
                        </div>
                        }
                    </div>

                    <!-- Delete Options -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-xl space-y-3">
                        <h3 class="text-sm font-medium text-gray-900 mb-3">Delete Options</h3>

                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" [(ngModel)]="deleteOptions().deleteImages"
                                class="w-4 h-4 rounded border-gray-300 text-red-600 focus:ring-red-500">
                            <span class="text-sm text-gray-700">Also delete associated images from storage</span>
                        </label>

                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" [(ngModel)]="deleteOptions().deleteVariants"
                                class="w-4 h-4 rounded border-gray-300 text-red-600 focus:ring-red-500">
                            <span class="text-sm text-gray-700">Delete all product variants</span>
                        </label>

                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" [(ngModel)]="deleteOptions().archiveInstead"
                                class="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            <span class="text-sm text-gray-700">Archive instead of delete (recommended)</span>
                        </label>
                    </div>

                    <!-- Confirmation Input -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-red-900 mb-2">
                            Type "DELETE {{ selectedProducts().length }} PRODUCTS" to confirm
                        </label>
                        <input type="text" [(ngModel)]="deleteConfirmation"
                            placeholder="DELETE {{ selectedProducts().length }} PRODUCTS"
                            class="w-full px-4 py-3 bg-white border border-red-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500/20 focus:border-red-500 text-red-900 font-mono">
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex items-center justify-end gap-3 pt-6 border-t border-red-100">
                        <button routerLink="/products"
                            class="px-4 py-2.5 bg-white border border-gray-200 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-all">
                            Cancel
                        </button>
                        <button (click)="executeDelete()"
                            [disabled]="deleteConfirmation() !== 'DELETE' + selectedProducts().length + 'PRODUCTS' || isProcessing()"
                            class="px-6 py-2.5 bg-red-600 text-white rounded-xl font-medium hover:bg-red-700 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-red-200">
                            @if (isProcessing()) {
                            <i class="bi bi-arrow-repeat spin"></i>
                            <span>Deleting...</span>
                            } @else {
                            <i class="bi bi-trash3"></i>
                            <span>Permanently Delete</span>
                            }
                        </button>
                    </div>
                </div>
                }

            </div>
        </div>

        <!-- History Sidebar -->
        @if (showHistory()) {
        <div class="fixed inset-y-0 right-0 w-full sm:w-96 bg-white shadow-2xl z-50 transform transition-transform duration-300"
            [class.translate-x-0]="showHistory()" [class.translate-x-full]="!showHistory()">
            <div class="h-full flex flex-col">
                <div class="px-6 py-4 border-b border-gray-100 flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900">Operation History</h2>
                    <button (click)="showHistory.set(false)"
                        class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-6 space-y-4">
                    @for (item of operationHistory(); track item.id) {
                    <div class="p-4 bg-gray-50 rounded-xl border border-gray-100">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <div class="w-8 h-8 rounded-lg flex items-center justify-center"
                                    [class.bg-indigo-100]="item.type === 'edit'"
                                    [class.bg-green-100]="item.type === 'import'"
                                    [class.bg-blue-100]="item.type === 'export'"
                                    [class.bg-purple-100]="item.type === 'copy'"
                                    [class.bg-red-100]="item.type === 'delete'">
                                    <i class="bi bi-{{item.icon}} text-sm"
                                        [class.text-indigo-600]="item.type === 'edit'"
                                        [class.text-green-600]="item.type === 'import'"
                                        [class.text-blue-600]="item.type === 'export'"
                                        [class.text-purple-600]="item.type === 'copy'"
                                        [class.text-red-600]="item.type === 'delete'"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-900 text-sm">{{ item.title }}</p>
                                    <p class="text-xs text-gray-500">{{ item.timestamp | date:'MMM d, y HH:mm' }}</p>
                                </div>
                            </div>
                            <span class="px-2 py-0.5 rounded-full text-xs font-medium"
                                [class.bg-green-100]="item.status === 'completed'"
                                [class.text-green-700]="item.status === 'completed'"
                                [class.bg-yellow-100]="item.status === 'pending'"
                                [class.text-yellow-700]="item.status === 'pending'"
                                [class.bg-red-100]="item.status === 'failed'"
                                [class.text-red-700]="item.status === 'failed'">
                                {{ item.status | titlecase }}
                            </span>
                        </div>
                        <p class="text-sm text-gray-600 mb-2">{{ item.description }}</p>
                        <div class="flex items-center gap-2 text-xs text-gray-500">
                            <i class="bi bi-box-seam"></i>
                            <span>{{ item.affectedCount }} products</span>
                            @if (item.duration) {
                            <span class="ml-auto">{{ item.duration }}s</span>
                            }
                        </div>
                        @if (item.canUndo && item.status === 'completed') {
                        <button (click)="undoOperation(item.id)"
                            class="mt-2 text-xs text-indigo-600 hover:text-indigo-700 font-medium flex items-center gap-1">
                            <i class="bi bi-arrow-counterclockwise"></i>
                            Undo this operation
                        </button>
                        }
                    </div>
                    } @empty {
                    <div class="text-center py-8">
                        <i class="bi bi-clock-history text-gray-300 text-4xl mb-2"></i>
                        <p class="text-sm text-gray-500">No operations yet</p>
                    </div>
                    }
                </div>
            </div>
        </div>
        <div class="fixed inset-0 bg-black/30 z-40" [class.hidden]="!showHistory()" (click)="showHistory.set(false)">
        </div>
        }

        <!-- Settings Modal -->
        @if (showSettings()) {
        <div
            class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg animate-slide-up">
                <div class="px-6 py-4 border-b border-gray-100 flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900">Bulk Operations Settings</h2>
                    <button (click)="showSettings.set(false)"
                        class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <div class="p-6 space-y-4">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                        <div>
                            <p class="font-medium text-gray-900">Auto-save Progress</p>
                            <p class="text-xs text-gray-500">Save operation state every 30 seconds</p>
                        </div>
                        <input type="checkbox" [(ngModel)]="settings().autoSave"
                            class="w-5 h-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                        <div>
                            <p class="font-medium text-gray-900">Confirm Before Execute</p>
                            <p class="text-xs text-gray-500">Show confirmation dialog for destructive actions</p>
                        </div>
                        <input type="checkbox" [(ngModel)]="settings().confirmBeforeExecute"
                            class="w-5 h-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                        <div>
                            <p class="font-medium text-gray-900">Email Notifications</p>
                            <p class="text-xs text-gray-500">Send email when bulk operations complete</p>
                        </div>
                        <input type="checkbox" [(ngModel)]="settings().emailNotifications"
                            class="w-5 h-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    </div>
                    <div class="p-3 bg-gray-50 rounded-xl">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Default Items Per Page</label>
                        <select [(ngModel)]="settings().defaultPageSize"
                            class="w-full px-3 py-2 bg-white border border-gray-200 rounded-lg">
                            <option [value]="10">10 items</option>
                            <option [value]="25">25 items</option>
                            <option [value]="50">50 items</option>
                            <option [value]="100">100 items</option>
                        </select>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-100 flex justify-end gap-3">
                    <button (click)="showSettings.set(false)"
                        class="px-4 py-2 text-gray-700 font-medium hover:bg-gray-100 rounded-xl transition-colors">
                        Cancel
                    </button>
                    <button (click)="saveSettings()"
                        class="px-4 py-2 bg-indigo-600 text-white font-medium rounded-xl hover:bg-indigo-700 transition-colors">
                        Save Settings
                    </button>
                </div>
            </div>
        </div>
        }

        <!-- Product Selector Modal -->
        @if (showProductSelector()) {
        <div
            class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[80vh] flex flex-col animate-slide-up">
                <div class="px-6 py-4 border-b border-gray-100 flex items-center justify-between">
                    <div>
                        <h2 class="text-lg font-semibold text-gray-900">Select Products</h2>
                        <p class="text-sm text-gray-500">{{ productSelectorSelected().length }} products selected</p>
                    </div>
                    <button (click)="closeProductSelector()"
                        class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <div class="p-4 border-b border-gray-100">
                    <div class="relative">
                        <i class="bi bi-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <input type="text" [(ngModel)]="productSelectorQuery" (input)="searchProducts()"
                            placeholder="Search products by name, SKU, or category..."
                            class="w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500">
                    </div>
                </div>
                <div class="flex-1 overflow-y-auto p-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        @for (product of productSelectorResults(); track product.id) {
                        <label
                            class="flex items-center gap-3 p-3 border border-gray-200 rounded-xl cursor-pointer hover:bg-gray-50 transition-colors"
                            [class.bg-indigo-50]="isProductSelected(product.id)"
                            [class.border-indigo-300]="isProductSelected(product.id)">
                            <input type="checkbox" [checked]="isProductSelected(product.id)"
                                (change)="toggleProductSelection(product)"
                                class="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            <img [src]="product.image" class="w-12 h-12 rounded-lg object-cover bg-gray-200">
                            <div class="flex-1 min-w-0">
                                <p class="font-medium text-gray-900 text-sm truncate">{{ product.name }}</p>
                                <p class="text-xs text-gray-500">{{ product.sku }} â€¢ {{ product.category }}</p>
                            </div>
                        </label>
                        } @empty {
                        <div class="col-span-2 text-center py-8">
                            <i class="bi bi-search text-gray-300 text-3xl mb-2"></i>
                            <p class="text-gray-500">No products found</p>
                        </div>
                        }
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-100 flex items-center justify-between">
                    <span class="text-sm text-gray-500">{{ productSelectorResults().length }} products available</span>
                    <div class="flex gap-3">
                        <button (click)="selectAllProducts()"
                            class="px-4 py-2 text-indigo-600 font-medium hover:bg-indigo-50 rounded-xl transition-colors">
                            Select All
                        </button>
                        <button (click)="confirmProductSelection()"
                            class="px-6 py-2 bg-indigo-600 text-white font-medium rounded-xl hover:bg-indigo-700 transition-colors">
                            Add {{ productSelectorSelected().length }} Products
                        </button>
                    </div>
                </div>
            </div>
        </div>
        }

    </div>
</div>